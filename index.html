<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>PHP 7 is (almost) here</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="reveal.js/css/reveal.css">
		<link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">

    <!-- CSS overrides -->
    <link rel="stylesheet" href="css/style.css">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="reveal.js/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
          <h1>PHP 7 is <small>(almost)</small> here</h1>
          <h2 class="horror">OMG! PANIC!</h2>
          <h5>
            Adam Harvey
            <br>
            <a href="https://twitter.com/LGnome">@LGnome</a>
            <br>
            <a href="http://newrelic.com">New Relic</a>
          </h5>
				</section>

        <section data-background="images/php7.png">
          <aside class="notes">
            As Zeev talked about yesterday, there are many reasons why you might want to move to PHP 7.
          </aside>
        </section>

        <section>
          <h2>It's faster</h2>
          <canvas id="phpdoc-chart" width="900" height="500"></canvas>
          <aside class="notes">
            Building php-doc. Never trust a benchmark you didn't fake yourself.
          </aside>
        </section>

        <section data-background="images/rfc.png">
          <h2>It's better</h2>
          <p>43 RFCs</p>
          <p>9,054 commits (and counting)</p>
          <aside class="notes">
            Features! Features! Features!
          </aside>
        </section>

        <section data-background="images/githut.png">
          <aside class="notes">
            If that was the carrot, here's the stick. We have a problem: PHP (mostly 5) is popular. Really popular. 140k GitHub projects. Countless sites.
          </aside>
        </section>

        <section>
          <img src="images/support.png">
          <aside class="notes">
            PHP 5 isn't long for this world.
          </aside>
        </section>

        <section>
          <h2>PHP 5.6 is EOL on<br>August 28, 2017</h2>
          <aside class="notes">
            Or, what that really means is&hellip;
          </aside>
        </section>

        <section>
          <h2>PHP <strong>&lt; 7</strong> is EOL on<br>August 28, 2017</h2>
        </section>

        <section>
          <h3>(that's in 2 years, 3 months, 7 days)</h3>
          <aside class="notes">
            That's your changeover period. You <em>have</em> to support PHP 7 by the end of that period. Probably much sooner than that.
          </aside>
        </section>

        <section data-background="images/panic.jpg">
        </section>

        <section data-background="images/dont-panic.jpg">
          <aside class="notes">
            OK, so we're not flailing about any more. What should we do instead?
          </aside>
        </section>

        <section data-background="images/head-in-sand.jpg">
          <aside class="notes">
            You can just rely on distribution packages to buy a few more years.
          </aside>
        </section>

        <section>
          <h2>Distribution packages</h2>
          <p>Ubuntu 14.04: PHP 5.5.9, supported to 4/2019</p>
          <p>RHEL 7: PHP 5.4.16, supported to 6/2024</p>
          <aside class="notes">
            Red Hat's support runs for another nine years. Think about where you were in 2006.
          </aside>
        </section>

        <section data-background="images/flag-day.gif">
          <aside class="notes">
            You can have a flag day and just change over. This doesn't work so well if you're a downstream project, though.
          </aside>
        </section>

        <section data-background="images/dual-wield.jpg">
          <aside class="notes">
            Or you can dual wield PHP 5 and 7. And now I shall undermine the entire concept of this presentation.
          </aside>
        </section>

        <section>
          <img src="images/lorna-tweet.png">
          <aside class="notes">
            This is a huge advantage.
          </aside>
        </section>

        <section>
          <img class="stretch" src="images/python3.png">
          <aside class="notes">
            Python 3.0 came out six and a half years ago. Adoption has been rocky because of the difficulty in supporting both versions. PHP 7 (hopefully) won't have that problem.
          </aside>
        </section>

        <section data-background="images/what-do.jpg">
          <aside class="notes">
            What do I do? That depends on who you are and what you do.
          </aside>
        </section>

        <section>
          <h2>Library authors</h2>
          <aside class="notes">
            TELL YOUR USERS. Support both versions for a reasonable period. Document that. Tell your users more.
          </aside>
        </section>

        <section>
          <h2>Library users</h2>
          <h3>(also known as everyone)</h3>
          <aside class="notes">
            Look for support policies. You can either have a flag day or support both, but if you're in a team (n&gt;1) environment, the latter is better, even if it's for a shorter period.
          </aside>
        </section>

        <section>
          <h2>
            <span class="mega-octicon octicon-git-pull-request"></span>
          </h2>
          <aside class="notes">
            Don't be afraid of making changes to libraries to support PHP 7, but do be afraid of maintaining long lived forks. You need to get them upstream.
          </aside>
        </section>

        <section data-background="images/strategy.jpg">
          <aside class="notes">
            So, how do we do this?
          </aside>
        </section>

        <section>
          <!-- TODO: background image of code coverage -->
          <h2>Testing</h2>
          <aside class="notes">
            If you don't have regression tests, get writing. These are the single biggest weapon you have to combat BC breaks. Code coverage and Derick and Sebastian's newly implemented branch coverage stats will help guide you in terms of whether you're testing enough.
          </aside>
        </section>

        <section>
          <h2>Tooling</h2>
        </section>

        <section>
          <!-- TODO: background image of PHPUnit failures -->
          <h2>Try it!</h2>
          <aside class="notes">
            Install PHP 7 in a development/CI environment with E_ALL. See what breaks. Rinse and repeat.
          </aside>
        </section>

        <section data-background="images/broken.jpg">
          <aside class="notes">
            What's broken? (and how do we fix them)
          </aside>
        </section>

        <section>
          <h2>Variable handling</h2>
          <aside class="notes">
            This sounds bad. It's both better and worse than you think.
          </aside>
        </section>

        <section>
          <h2>Indirect references</h2>
        </section>

        <section>
          <pre><code class="php" data-trim>
$$foo['bar']['baz']
$foo-&gt;$bar['baz']
$foo-&gt;$bar['baz']()
Foo::$bar['baz']()
          </code></pre>
          <aside class="notes">
            These have all changed behaviour in PHP 7. Silently. Insidiously. I'll break these down one at a time in a minute, but first&hellip;
          </aside>
        </section>

        <section>
          <h2>Why?</h2>
          <aside class="notes">
            &hellip;why are we inflicting this pain upon you, the developer?
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
$foo()['bar']()
$foo::$bar::$baz
Foo::bar()()
(function() { ... })()
($obj-&gt;closure)()
[$obj, 'method']()
          </code></pre>
          <aside class="notes">
            These &mdash; and many other variations &mdash; are now supported in PHP 7.0. Check the uniform variable syntax RFC.
          </aside>
        </section>

        <section>
          <img class="stretch hide-border" src="images/awesome.png">
          <aside class="notes">
            Obviously, this is awesome. But the pain. On the bright side, this is one of those things that's really rare: when Nikita was working on this, he only found one instance in all of Symfony and Zend Framework where this mattered.
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
$$foo['bar']['baz'];
          </code></pre>
          <h3>in PHP 5:</h3>
          <pre><code class="php" data-trim>
${$foo['bar']['baz']};
          </code></pre>
          <aside class="notes">
            This is interpreted in PHP 5 as "take the value of $foo['bar']['baz'] and use that as a variable name". (Of course, if you're using variable variables anyway, you have already lost.)
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
$$foo['bar']['baz'];
          </code></pre>
          <h3>in PHP 7:</h3>
          <pre><code class="php" data-trim>
($$foo)['bar']['baz'];
          </code></pre>
          <aside class="notes">
            PHP 7: take the value of $foo, use that as a variable name, and then access ['bar']['baz'].
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
$foo-&gt;$bar['baz']
          </code></pre>
          <h3>in PHP 5:</h3>
          <pre><code class="php" data-trim>
$foo-&gt;{$bar['baz']}
          </code></pre>
          <aside class="notes">
            This is interpreted in PHP 5 as "take the value of $bar['baz'], and use that as a property name".
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
$foo-&gt;$bar['baz']
          </code></pre>
          <h3>in PHP 7:</h3>
          <pre><code class="php" data-trim>
($foo-&gt;$bar)['baz']
          </code></pre>
          <aside class="notes">
            PHP 7: take the value of $foo-&gt;bar, and then access the baz variable. There's also the same thing for method calls (which was the third variation shown earlier).
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
Foo::$bar['baz']()
          </code></pre>
          <h3>in PHP 5:</h3>
          <pre><code class="php" data-trim>
Foo::{$bar['baz']}()
          </code></pre>
          <aside class="notes">
            This is interpreted in PHP 5 as "take the value of $bar['baz'], and use that as a static property name". This is probably the most common variant of the four.
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
Foo::$bar['baz']()
          </code></pre>
          <h3>in PHP 7:</h3>
          <pre><code class="php" data-trim>
(Foo::$bar)['baz']()
          </code></pre>
          <aside class="notes">
            PHP 7: Take the value of the static $bar property of Foo, then get the array value, then call that callable.
          </aside>
        </section>

        <section>
          <h2>What do you do?</h2>
        </section>

        <section>
          <pre><code class="php" data-trim>
Foo::$bar['baz']()
          </code></pre>
        </section>

        <section>
          <pre><code class="php" data-trim>
Foo::$bar['baz']()
          </code></pre>
          <h3>Using curly braces:</h3>
          <pre><code class="php" data-trim>
Foo::{$bar['baz']}()
          </code></pre>
          <aside class="notes">
            The earlier examples with parentheses and/or curly braces will work for preserving PHP 5 behaviour.
          </aside>
        </section>

        <section>
          <pre><code class="php" data-trim>
Foo::$bar['baz']()
          </code></pre>
          <h3>Break it down:</h3>
          <pre><code class="php" data-trim>
$method = $bar['baz'];
Foo::$method();
          </code></pre>
          <aside class="notes">
            I'd prefer this for clarity.
          </aside>
        </section>

        <section>
          <h2>Finding instances</h2>
        </section>

        <section>
          <h2 class="lowercase">IDEs</h2>
        </section>

        <section>
          <pre><code class="bash" data-trim>
git grep -E '((((::)|(-&gt;))\$'\
  '[a-zA-Z_][a-zA-Z0-9_]*)+'\
  '\[[^\s]+\]\())|(-&gt;\$[a-zA-Z_]'\
  '[a-zA-Z0-9_]*\[)|'\
  '(\$\$[a-zA-Z_][a-zA-Z0-9_]*\[)'
          </code></pre>
          <aside class="notes">
            I'll tweet this later. This isn't perfect (doesn't support non-ASCII variable names), but will probably catch most sins.
          </aside>
        </section>

        <section>
          <h2>Image credits</h2>
          <p><em>PHP7</em>: <a href="https://twitter.com/elroubio">Vincent Pontier</a></p>
          <p><em>Panic</em>: <a href="https://flic.kr/p/pwcRe1">wackystuff</a> (CC-BY-SA 2.0)</p>
          <p><em>Don't panic</em>: <a href="https://flic.kr/p/4hiM1k">Jim Linwood</a> (CC-BY-SA 2.0)</p>
          <p><em>Head in sand</em>: <a href="https://flic.kr/p/5q67Vu">Peter</a> (CC-BY-SA 2.0)</p>
          <p><em>Flag day</em>: <a href="https://flic.kr/p/7pvbw5">Seattle Municipal Archives</a> (CC-BY 2.0)</p>
          <p><em>Dual wield</em>: <a href="https://flic.kr/p/8yhodT">Joriel Jimenez</a> (CC-BY 2.0)</p>
          <p><em>What do?</em>: <a href="https://flic.kr/p/9fwoMs">Ian Sane</a> (CC-BY 2.0)</p>
          <p><em>Strategy</em>: <a href="https://flic.kr/p/7TpXix">Horia Varlan</a> (CC-BY 2.0)</p>
        </section>
			</div>

		</div>

		<script src="reveal.js/lib/js/head.min.js"></script>
		<script src="reveal.js/js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: false,
				progress: false,
				history: true,
				center: true,

				transition: 'fade', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'reveal.js/plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
					{ src: 'reveal.js/plugin/notes/notes.js', async: true }
				]
			});

		</script>

    <script src="js/Chart.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var ctx = document.getElementById("phpdoc-chart").getContext("2d");
        var chart = new Chart(ctx).Bar(
          {
            labels: ["5.3", "5.4", "5.5", "5.6", "7.0"],
            datasets: [
              {
                data: [36.875, 28.123, 26.384, 25.336, 19.728]
              }
            ]
          },
          {
            responsive: true,
            scaleFontColor: "#333",
            scaleFontFamily: "'Open Sans'",
            scaleFontSize: 40,
            scaleLabel: " <%=value%>",
            scaleShowHorizontalLines: false,
            scaleShowVerticalLines: false,
          }
        );
      });
    </script>


	</body>
</html>
